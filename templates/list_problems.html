{% extends 'base.html' %}

{% block content %}
<div class="container mt-5">
    <div class="row">
        <div class="col-12">
            <h1>Problem Dashboard</h1>
        </div>
    </div>
    <div class="row">
        <div class="col-2">
            {% if current_user.is_editor %}
            <button type="button" class="btn btn-primary ml-2" data-toggle="modal" data-target="#new_problem_modal">New
                Problem</button>
            {% endif %}
        </div>
        <div class="col-5">
            <div class="input-group">
                <div class="input-group-prepend">
                    <label class="input-group-text" for="filter-topic">Topic:</label>
                </div>
                <select class="custom-select" id="filter-topic">
                    <option value="">All Topics</option>
                    {% for topic in topics %}
                    <option value="{{ topic.id }}">{{ topic.title }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <div class="col-5">
            <div class="input-group ml-3">
                <input type="text" id="search" class="form-control" placeholder="Search...">
                <div class="input-group-append">
                    <button class="btn btn-outline-secondary" type="button">Search</button>
                </div>
            </div>
        </div>
    </div>

    <table class="table mt-5">
        <thead>
            <tr>
                <th>Topic</th>
                <th>Text</th>
                {% if current_user.is_editor %}
                <th>Actions</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for problem in problems %}
            <tr class="search-item" style="cursor: pointer;" onmouseover="this.style.backgroundColor='#f7f7f7';"
                onmouseout="this.style.backgroundColor='transparent';">
                <td onclick="location.href='{{ url_for('problem', problem_id=problem.id) }}';">
                    <div style="display:none;">{{ problem.topic_id }}</div>{{ problem.topic_title }}
                </td>
                <td onclick="location.href='{{ url_for('problem', problem_id=problem.id) }}';">{{ problem.text }}</td>
                {% if current_user.is_editor %}
                <td>
                    <a href="{{ url_for('edit_problem', problem_id=problem.id) }}"
                        class="btn btn-secondary btn-sm">Edit</a>
                    <button type="button" class="btn btn-secondary btn-sm" data-toggle="modal"
                        data-target="#move_problem_modal" data-problem-id="{{ problem.id }}">Move</button>
                    <button type="button" class="btn btn-danger btn-sm" data-toggle="modal"
                        data-target="#delete_problem_modal" data-problem-id="{{ problem.id }}">Delete</button>
                </td>
                {% endif %}
            </tr>
            {% endfor %}
        </tbody>
    </table>

</div>
{% include 'new_problem_modal.html' %}
{% include 'move_problem_modal.html' %}
{% include 'delete_problem_modal.html' %}
{% endblock %}

{% block scripts %}
<script>
    function text_search() {
        var value = $('#search').val().toLowerCase();
        $('.search-item').filter(function () {
            $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
        });
    };
    function topic_search() {
        var value = $('#filter-topic').val().toLowerCase();
        $('.search-item').filter(function () {
            $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
        });
    };

    $(document).ready(function () {
        // Function to perform search on keyup event
        $('#search').on('keyup', text_search);
        $('#search_button').on('click', text_search);
        $('#filter-topic').on('change', topic_search);
    });
</script>
{% endblock %}